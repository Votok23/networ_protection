# Домашнее задание к занятию "Защита хоста" - Котов Г.И.




### Задание 1

Проведите разведку системы и определите, какие сетевые службы запущены на защищаемой системе:

sudo nmap -sA < ip-адрес >

sudo nmap -sT < ip-адрес >

sudo nmap -sS < ip-адрес >

sudo nmap -sV < ip-адрес >

По желанию можете поэкспериментировать с опциями: https://nmap.org/man/ru/man-briefoptions.html.

В качестве ответа пришлите события, которые попали в логи Suricata и Fail2Ban, прокомментируйте результат.


### Решение 1: 

Результаты сканирования nmap:

1. ACK сканирование (-sA): Все порты в состоянии "ignored/unfiltered"

2. TCP сканирование (-sT): Все порты закрыты (conn-refused)

3. SYN сканирование (-sS): Все порты закрыты (reset)

4. Сканирование версий (-sV): Все порты закрыты

Анализ логов Suricata:

В логах Suricata не обнаружено событий, связанных с сканированием nmap. Это объясняется следующими причинами:

1. Suricata запущен без загруженных правил обнаружения (rules_loaded: 0)

2. В логах видны только статистические данные и информация о сетевых потоках

3. Отсутствуют правила для обнаружения сетевого сканирования

Анализ логов Fail2Ban:

В логах Fail2Ban не обнаружено событий блокировки, потому что:

1. Не было попыток подключения к SSH (все порты закрыты)

2. Fail2Ban успешно запущен и мониторит службу sshd

3. Но поскольку сканирование nmap не затрагивало SSH-порт, Fail2Ban не сработал

Комментарий:
Защищаемая система оказалась хорошо защищенной - все сетевые порты закрыты, что делает невозможным определение запущенных служб через nmap. Это типичное поведение системы с минимальной конфигурацией сетевых служб.

Suricata не смог обнаружить сканирование из-за отсутствия правил обнаружения атак.

Fail2Ban не активировался, так как не было целевых атак на SSH-сервис.

Вывод: Без дополнительной настройки правил Suricata не эффективен для обнаружения сетевого сканирования, а Fail2Ban активируется только при конкретных атаках на защищаемые службы.


### Задание 2

Проведите атаку на подбор пароля для службы SSH:

hydra -L users.txt -P pass.txt < ip-адрес > ssh

Настройка hydra:
создайте два файла: users.txt и pass.txt;
в каждой строчке первого файла должны быть имена пользователей, второго — пароли. В нашем случае это могут быть случайные строки, но ради эксперимента можете добавить имя и пароль существующего пользователя.
Дополнительная информация по hydra: https://kali.tools/?p=1847.

Включение защиты SSH для Fail2Ban:
открыть файл /etc/fail2ban/jail.conf,
найти секцию ssh,
установить enabled в true.
Дополнительная информация по Fail2Ban:https://putty.org.ru/articles/fail2ban-ssh.html.

В качестве ответа пришлите события, которые попали в логи Suricata и Fail2Ban, прокомментируйте результат.

### Решение 2 Анализ результатов: 

Результаты атаки Hydra:

1. Hydra провела 20 попыток входа (4 пользователя × 5 паролей)

2. Атака не увенчалась успехом - 0 валидных паролей найдено

3. Время атаки: 4 секунды

Анализ логов Fail2Ban:
Fail2Ban успешно сработал!

1. Обнаружено 27 неудачных попыток входа

2. IP-адрес 10.0.2.15 забанен

3. Время бана: 600 секунд (10 минут)

4. Fail2Ban корректно отслеживал множественные попытки подключения и сработал после превышения лимита (maxretry = 3)

Анализ логов Suricata:

Suricata не обнаружил атаку Hydra, что ожидаемо по тем же причинам:

1. Отсутствуют загруженные правила (rules_loaded: 0)

2. В логах видны только DNS-запросы и статистика

3. Нет правил для обнаружения brute-force атак на SSH

Комментарий:
Fail2Ban эффективно защитил систему от brute-force атаки:

1. Автоматически обнаружил множественные неудачные попытки аутентификации

2. Заблокировал атакующий IP-адрес на 10 минут

3. Предотвратил дальнейшие попытки подбора пароля

Suricata без правил не предоставляет защиты от атак на уровне приложений.

Вывод: Fail2Ban является эффективным инструментом защиты от brute-force атак на SSH, в то время как Suricata требует дополнительной настройки правил для обнаружения подобных угроз.